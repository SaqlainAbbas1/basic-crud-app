<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student CRUD App</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../public/styles/main.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</head>
<body>
    <div class="container mt-5">
        <h2 class="text-center mb-4">Student Management</h2>

        <!-- Action Buttons -->
        <div class="text-center mb-4">
            <button id="showAddForm" class="btn btn-primary">Add Student</button>
            <button id="showUpdateForm" class="btn btn-warning">Update Student</button>
            <button id="showDeleteForm" class="btn btn-danger">Delete Student</button>
            <button id="retrieveStudents" class="btn btn-info">Retrieve Students</button>
        </div>

        <!-- Add Student Form -->
        <div id="addForm" class="card mb-4" style="display: none;">
            <div class="card-header">
                <h5 class="card-title">Add New Student</h5>
            </div>
            <div class="card-body">
                <form id="studentForm">
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="name">Name</label>
                            <input type="text" class="form-control" id="name" placeholder="Enter Name" required>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="f_name">Father's Name</label>
                            <input type="text" class="form-control" id="f_name" placeholder="Enter Father's Name" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="field">Field of Study</label>
                            <input type="text" class="form-control" id="field" placeholder="Enter Field of Study" required>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="contact">Contact</label>
                            <input type="text" class="form-control" id="contact" placeholder="Enter Contact Number" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="address">Address</label>
                            <input type="text" class="form-control" id="address" placeholder="Enter Address" required>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="nationality">Nationality</label>
                            <input type="text" class="form-control" id="nationality" placeholder="Enter Nationality" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="email">Email</label>
                            <input type="email" class="form-control" id="email" placeholder="Enter Email" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Add Student</button>
                </form>
            </div>
        </div>

       <!-- Update Student Form -->
<div id="updateForm" class="card mb-4" style="display: none;">
    <div class="card-header">
        <h5 class="card-title">Update Student</h5>
    </div>
    <div class="card-body">
        <form id="searchStudentForm">
            <div class="form-group">
                <label for="searchEmail">Search Student by Email</label>
                <input type="email" class="form-control" id="searchEmail" placeholder="Enter Email to search" required>
                <button type="submit" class="btn btn-primary mt-2">Search</button>
            </div>
        </form>
        <form id="updateStudentForm" style="display: none;">
            <input type="hidden" id="updateStudentId">
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="updateName">Name</label>
                    <input type="text" class="form-control" id="updateName" placeholder="Enter Name" required>
                </div>
                <div class="form-group col-md-6">
                    <label for="updateFName">Father's Name</label>
                    <input type="text" class="form-control" id="updateFName" placeholder="Enter Father's Name" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="updateField">Field of Study</label>
                    <input type="text" class="form-control" id="updateField" placeholder="Enter Field of Study" required>
                </div>
                <div class="form-group col-md-6">
                    <label for="updateContact">Contact</label>
                    <input type="text" class="form-control" id="updateContact" placeholder="Enter Contact Number" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="updateAddress">Address</label>
                    <input type="text" class="form-control" id="updateAddress" placeholder="Enter Address" required>
                </div>
                <div class="form-group col-md-6">
                    <label for="updateNationality">Nationality</label>
                    <input type="text" class="form-control" id="updateNationality" placeholder="Enter Nationality" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="updateEmail">Email</label>
                    <input type="email" class="form-control" id="updateEmail" placeholder="Enter Email" required>
                </div>
            </div>
            <button type="submit" class="btn btn-warning">Update Student</button>
        </form>
    </div>
</div>


        <!-- Delete Student Form -->
        <div id="deleteForm" class="card mb-4" style="display: none;">
            <div class="card-header">
                <h5 class="card-title">Delete Student</h5>
            </div>
            <div class="card-body">
                <form id="deleteStudentForm">
                    <input type="hidden" id="deleteStudentId">
                    <div class="form-group">
                        <label for="deleteStudentEmail">Email</label>
                        <input type="email" class="form-control" id="deleteStudentEmail" placeholder="Enter Email of the student to delete" required>
                    </div>
                    <button type="submit" class="btn btn-danger">Delete Student</button>
                </form>
            </div>
        </div>

        <!-- Students List -->
        <div class="card">
            <div class="card-header">
                <h5 class="card-title">Students List</h5>
            </div>
            <div class="card-body">
                <table id="studentsTable" class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Father's Name</th>
                            <th>Field of Study</th>
                            <th>Contact</th>
                            <th>Address</th>
                            <th>Nationality</th>
                            <th>Email</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- List of students will be dynamically inserted here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>

    $(document).ready(function() {
    const addForm = $('#addForm');
    const updateForm = $('#updateForm');
    const deleteForm = $('#deleteForm');

    // Toggle Add Form
    $('#showAddForm').on('click', function() {
        addForm.fadeToggle();  
        updateForm.hide();
        deleteForm.hide();
    });

    // Toggle Update Form
    $('#showUpdateForm').on('click', function() {
        updateForm.fadeToggle();  
        addForm.hide();
        deleteForm.hide();
    });

    // Toggle Delete Form
    $('#showDeleteForm').on('click', function() {
        deleteForm.fadeToggle();  
        addForm.hide();
        updateForm.hide();
    });

    // Fetch Students
    $('#retrieveStudents').on('click', function() {
        fetchStudents();
    });

    // Add Student
    $('#studentForm').on('submit', function(event) {
        event.preventDefault();

        const studentData = {
            name: $('#name').val(),
            f_name: $('#f_name').val(),
            field: $('#field').val(),
            contact: $('#contact').val(),
            address: $('#address').val(),
            nationality: $('#nationality').val(),
            email: $('#email').val()
        };

        addStudent(studentData);
    });

    // Update Student
    $('#updateStudentForm').on('submit', function(event) {
        event.preventDefault();

        const studentId = $('#updateStudentId').val();
        const updatedData = {
            name: $('#updateName').val(),
            f_name: $('#updateFName').val(),
            field: $('#updateField').val(),
            contact: $('#updateContact').val(),
            address: $('#updateAddress').val(),
            nationality: $('#updateNationality').val(),
            email: $('#updateEmail').val()
        };

        updateStudent(studentId, updatedData);
    });

    // Delete Student
    $('#deleteStudentForm').on('submit', function(event) {
        event.preventDefault();

        const studentEmail = $('#deleteStudentEmail').val();
        deleteStudentByEmail(studentEmail);
    });

    // Fetch students on page load
    fetchStudents();
});

// Function to Add Student
function addStudent(studentData) {
    $.ajax({
        url: '/students',
        type: 'POST',
        contentType: 'application/json',
        data: JSON.stringify(studentData),
        success: function() {
            alert('Student added successfully');
            fetchStudents();
            $('#studentForm')[0].reset();
            $('#addForm').hide();
        },
        error: function(error) {
            alert('Error adding student: ' + error.responseText);
        }
    });
}

// Function to fetch students and set onclick event for rows
function fetchStudents() {
    $.ajax({
        url: '/students',
        type: 'GET',
        success: function(students) {
            let studentRows = '';
            students.forEach(student => {
                studentRows += `
                    <tr data-id="${student.id}" onclick="showUpdateForm(${student.id})">
                        <td>${student.name}</td>
                        <td>${student.f_name}</td>
                        <td>${student.field}</td>
                        <td>${student.contact}</td>
                        <td>${student.address}</td>
                        <td>${student.nationality}</td>
                        <td>${student.email}</td>
                    </tr>
                `;
            });
            $('#studentsTable tbody').html(studentRows);
        },
        error: function(error) {
            alert('Error fetching students: ' + error.responseText);
        }
    });
}
// Function to fetch student details and show update form
function showUpdateForm(studentId) {
    $.ajax({
        url: `/students/${studentId}`,
        type: 'GET',
        success: function(student) {
            $('#updateStudentId').val(student.id);
            $('#updateName').val(student.name);
            $('#updateFName').val(student.f_name);
            $('#updateField').val(student.field);
            $('#updateContact').val(student.contact);
            $('#updateAddress').val(student.address);
            $('#updateNationality').val(student.nationality);
            $('#updateEmail').val(student.email);

            $('#updateForm').show();
        },
        error: function(error) {
            alert('Error fetching student details: ' + error.responseText);
        }
    });
}

// Function to update student
function updateStudent(studentId, updatedData) {
    $.ajax({
        url: `/students/${studentId}`,
        type: 'PUT',
        contentType: 'application/json',
        data: JSON.stringify(updatedData),
        success: function() {
            alert('Student updated successfully');
            fetchStudents();
            $('#updateForm').hide();
        },
        error: function(error) {
            alert('Error updating student: ' + error.responseText);
        }
    });
}

// Search Student by Email
$('#searchStudentForm').on('submit', function(event) {
    event.preventDefault();

    const email = $('#searchEmail').val();
    fetchStudentByEmail(email);
});

// Fetch Student by Email
function fetchStudentByEmail(email) {
    $.ajax({
        url: `/students/email/${email}`,
        type: 'GET',
        success: function(student) {
            if (student) {
                $('#updateStudentId').val(student.id);
                $('#updateName').val(student.name);
                $('#updateFName').val(student.f_name);
                $('#updateField').val(student.field);
                $('#updateContact').val(student.contact);
                $('#updateAddress').val(student.address);
                $('#updateNationality').val(student.nationality);
                $('#updateEmail').val(student.email);

                $('#updateForm').show();
                $('#searchStudentForm').hide();
                $('#updateStudentForm').show();
            } else {
                alert('Student not found');
            }
        },
        error: function(error) {
            alert('Error fetching student details: ' + error.responseText);
        }
    });
}


// Function to delete student by email
function deleteStudentByEmail(studentEmail) {
    console.log('Deleting student with email:', studentEmail); // Debugging line
    $.ajax({
        url: '/students',
        type: 'DELETE',
        contentType: 'application/json',
        data: JSON.stringify({ email: studentEmail }),
        success: function() {
            alert('Student deleted successfully');
            fetchStudents();
            $('#deleteForm').hide();
        },
        error: function(error) {
            console.error('Error deleting student:', error); // Debugging line
            alert('Error deleting student: ' + error.responseText);
        }
    });
}


    </script>
</body>
</html>
